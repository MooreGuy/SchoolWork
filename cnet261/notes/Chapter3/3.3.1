VLAN Security and Design

VLAN Hopping is when traffic can be seen from one VLAN by another VLAN

	Switch Spoofing

		Attacker takes advantage of the default configuration being dynamic
			auto.

		Emulates 802.1Q and DTP messages.

		Tricks switch into forming a trunk port.

		Allows access to all VLANs allowed on the trunk port.

		To prevent:

			Turn off trunking on ports that aren't trunks

			Disable DTP on required trunking ports and manually enable
				trunking	


	Double Tagging (double-encapsulated)

		Takes advantage of the way that hardware on most switches operate
			during de-encapsulation.

			Most switches only perform one layer.

		Works even if trunk ports are disabled because a host typically
			sends a frame on a segment taht is not a trunk link.

		Unidirectional and works only when the attacker is connected to a
			port residing in the same VLAN as the native VLAN of the trunk
			port.

		Thwarting the attack is not as easy as stopping basic VLAN hopping

		Mitigate by native VLAN of trunk ports is different than any user
			VLAN for user ports.

		Best practice is to used a fixed VLAN that is distinct from all
			user VLANs in the switched network as the native VLAN for all
			802.1Q trunks

		The attack is performed in three steps:

			1. Attacker sends double-tagged 802.1Q frame to switch

				Outer header has the VLAN tag of the attacker

					Same VLAN as the native VLAN of the trunk port
				
				Inner tage is still intact and not inspected by switch.

				Assume switch processes the frame received from the tacker
					as if it were on a trunk port or a port with a voice
					VLAN(a switch should not receive a tagged Ethernet frame
					from  an access port)


			2. Frame arrives on First Switch

				looks at the first 4-byte 802.1Q tag

				Switch sees a frame destined for VLAN 10, which is the
					native VLAN.

				Switch forwards the frame to all VLAN 10 ports after
					stripping the VLAN 10 tag.					

				At this point the VLAN 20 tag has not been inspected
			
			3. The second switch looks at the frame 

				sees it is destined for VLAN 20.

				Second switch sends the frame on to the victim port or
					floods it depending on whether there is an existing
					MAC address table entry for the victim host

	PVLAN Edge

		If no traffic should be forwared between ports on the same switch
			on layer 2 then a PVLAN would work.

		In a PVLAN:

			Protected ports ensure there is no exchange of unicast, 
				broadcast, or multicast traffic between other protected 
				ports on the switch at layer 2

			Forwarding behavior between a protected port and a non-protected
				port proceed as usual

			Protected ports must be manually configured

		To configure PVLAN Edge:
			
			[COMMANDS]S1(config-if)# switchport protected

		To disable it

			[COMMAND] S1(config-if)# no switchport protected

		To verify configuration

			[COMMAND] S1# show interfaces [interface-id] switchport
